<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Secure anonymous file hosting service">
    <title>VaultSphere &mdash; Secure Anonymous Cloud</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="theme-gradient">
    <div class="aurora-overlay" aria-hidden="true"></div>
    <main class="auth-shell">
        <section class="brand-panel">
            <div class="brand-panel-content">
                <span class="brand-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v11m0-11C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v11C4.168 16.477 5.754 16 7.5 16s3.332.477 4.5 1.253m0-11C13.168 5.477 14.754 5 16.5 5s3.332.477 4.5 1.253v11C19.832 16.477 18.246 16 16.5 16s-3.332.477-4.5 1.253" />
                    </svg>
                    Zero-Knowledge Storage
                </span>
                <h1 class="brand-title">Redefine trust with <span class="brand-highlight">VaultSphere</span></h1>
                <p class="brand-description">Spin up an anonymous enclave for your files in seconds. Your account key seeds the encryption &mdash; no emails, no passwords, just pure cryptography.</p>
                <div class="feature-grid">
                    <article class="feature-card">
                        <div class="feature-icon">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 1.343-3 3v1a3 3 0 0 0 6 0v-1c0-1.657-1.343-3-3-3Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 10c0 5-7 11-7 11S5 15 5 10a7 7 0 1 1 14 0Z" />
                            </svg>
                        </div>
                        <strong>Private by Design</strong>
                        <p>End-to-end encryption anchored to your personal account key. We can&rsquo;t see a thing.</p>
                    </article>
                    <article class="feature-card">
                        <div class="feature-icon">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                            </svg>
                        </div>
                        <strong>Integrity Guaranteed</strong>
                        <p>Client-side hashing verifies every upload, ensuring files arrive exactly as sent.</p>
                    </article>
                    <article class="feature-card">
                        <div class="feature-icon">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-6l-2-2H5a2 2 0 0 0-2 2Z" />
                            </svg>
                        </div>
                        <strong>Frameless Access</strong>
                        <p>Log in from any device with a single numeric key. No usernames or password resets needed.</p>
                    </article>
                </div>
                <div class="new-section">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m15 10-4 4-2-2" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.906 5.048A9 9 0 0 1 12 3a9 9 0 0 1 9 9 9.004 9.004 0 0 1-6.708 8.717" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 21a9 9 0 0 1-7-11.621" />
                    </svg>
                    <span>New: Live progress indicators, one-tap copy keys, and refined motion design for a calmer flow.</span>
                </div>
            </div>
        </section>

        <section class="auth-card" aria-labelledby="auth-heading">
            <header class="auth-card-header">
                <h1 id="auth-heading">Launch your encrypted vault</h1>
                <p>Generate a fresh anonymous account or reconnect using your existing key.</p>
            </header>

            <div class="cta-group">
                <button id="createAccountBtn" class="btn btn-primary btn-full" type="button">
                    <span id="createAccountText">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m6-6H6" />
                        </svg>
                        Generate secure account
                    </span>
                    <span id="createAccountSpinner" class="hidden">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="animate-spin" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 12a8 8 0 0 1 8-8" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 20a8 8 0 0 0 8-8" opacity="0.45" />
                        </svg>
                        Creating account...
                    </span>
                </button>
                <p class="supporting-copy">We&rsquo;ll encrypt your vault, store nothing but ciphertext, and redirect you to the dashboard automatically.</p>
            </div>

            <div id="accountDisplay" class="account-display hidden" aria-live="polite">
                <span class="account-display__label">Account key &middot; keep this safe</span>
                <div class="account-pill">
                    <code id="accountKeyValue">AAAA-BBBB</code>
                    <button id="copyAccountKeyBtn" type="button" aria-label="Copy account key">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 8h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2v-2" />
                        </svg>
                    </button>
                </div>
                <p class="supporting-copy">Your account key <strong>is</strong> the encryption seed. Store it offline and share with no one.</p>
            </div>

            <div class="divider" role="separator" aria-hidden="true">Or sign back in</div>

            <form id="loginForm" class="form-stack" novalidate>
                <div class="form-field">
                    <label for="accountKeyInput">Account key</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="accountKeyInput"
                            name="account_key"
                            class="input-field"
                            placeholder="AAAA-BBBB-CCCC-DDDD"
                            inputmode="text"
                            autocomplete="off"
                            required
                            pattern="[A-Za-z2-7\\-\\s]+"
                            aria-describedby="account-help"
                        >
                        <div class="input-icon" aria-hidden="true">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.34 3.94c.69-.69 1.8-.69 2.48 0l7.24 7.24c.69.69.69 1.8 0 2.48l-5.81 5.82c-.69.69-1.8.69-2.48 0l-7.24-7.24a1.75 1.75 0 0 1 0-2.48l5.81-5.82Z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 10.75 12 15.25" />
                            </svg>
                        </div>
                    </div>
                    <p id="account-help" class="supporting-copy">Paste the exact account key you stored. Letters A-Z and digits 2-7 only.</p>
                </div>

                <button id="loginBtn" type="submit" class="btn btn-secondary btn-full">
                    <span id="loginText">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m9 11-4 4 4 4" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 15h11a4 4 0 0 0 4-4V7a2 2 0 0 0-2-2h-5" />
                        </svg>
                        Access dashboard
                    </span>
                    <span id="loginSpinner" class="hidden">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" class="animate-spin" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 9a8 8 0 1 0 0 6" opacity="0.45" />
                        </svg>
                        Verifying...
                    </span>
                </button>
            </form>

            <div class="status-stack" role="status">
                <div id="errorMessage" class="alert alert-error hidden">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                    <span id="errorText"></span>
                </div>
                <div id="successMessage" class="alert alert-success hidden">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m5 13 4 4L19 7" />
                    </svg>
                    <span id="successText"></span>
                </div>
            </div>

            <p class="footer-note">VaultSphere never stores your keys. Bookmark this page and keep your account key offline for safe keeping.</p>
        </section>
    </main>

    <script>
        const SESSION_ACCOUNT_KEY = 'vaultsphere.session.accountKey';
        const SESSION_ACCOUNT_ID = 'vaultsphere.session.accountId';

        function normalizeAccountKey(value) {
            return (value || '')
                .toUpperCase()
                .replace(/[^A-Z2-7]/g, '');
        }

        function formatAccountKey(value) {
            const normalized = normalizeAccountKey(value);
            if (!normalized) {
                return '';
            }
            return normalized.match(/.{1,4}/g).join('-');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successDiv.classList.remove('hidden');
            setTimeout(() => successDiv.classList.add('hidden'), 5000);
        }

        function setLoading(buttonId, textId, spinnerId, isLoading) {
            const button = document.getElementById(buttonId);
            const text = document.getElementById(textId);
            const spinner = document.getElementById(spinnerId);

            if (isLoading) {
                button.disabled = true;
                text.classList.add('hidden');
                spinner.classList.remove('hidden');
            } else {
                button.disabled = false;
                text.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        function cacheSessionAccount(accountId, normalizedKey) {
            if (accountId) {
                sessionStorage.setItem(SESSION_ACCOUNT_ID, accountId);
            }
            if (normalizedKey) {
                sessionStorage.setItem(SESSION_ACCOUNT_KEY, normalizedKey);
            }
        }

        document.getElementById('createAccountBtn').addEventListener('click', async () => {
            setLoading('createAccountBtn', 'createAccountText', 'createAccountSpinner', true);

            try {
                const response = await fetch('/api/create-account', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    const accountDisplay = document.getElementById('accountDisplay');
                    const accountKeyValue = document.getElementById('accountKeyValue');
                    accountKeyValue.textContent = data.account_key;
                    accountDisplay.classList.remove('hidden');

                    cacheSessionAccount(data.account_id, data.account_key_compact);
                    sessionStorage.setItem('vaultsphere.session.accountFingerprint', data.account_fingerprint || '');

                    document.getElementById('copyAccountKeyBtn')?.setAttribute('data-key', data.account_key_compact);

                    showSuccess('Account created successfully! Redirecting to dashboard...');

                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1500);
                } else {
                    showError(data.error || 'Failed to create account');
                }
            } catch (error) {
                showError('Network error. Please try again.');
                console.error('Error:', error);
            } finally {
                setLoading('createAccountBtn', 'createAccountText', 'createAccountSpinner', false);
            }
        });

        document.getElementById('copyAccountKeyBtn')?.addEventListener('click', () => {
            const key = document.getElementById('copyAccountKeyBtn').getAttribute('data-key')
                || normalizeAccountKey(document.getElementById('accountKeyValue').textContent);
            if (!key) {
                showError('Nothing to copy yet.');
                return;
            }
            navigator.clipboard.writeText(key).then(() => {
                showSuccess('Account key copied to clipboard!');
            }).catch(() => {
                showError('Failed to copy account key');
            });
        });

        document.getElementById('loginForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const input = document.getElementById('accountKeyInput');
            const normalizedKey = normalizeAccountKey(input.value.trim());

            if (!normalizedKey) {
                showError('Please enter your account key');
                return;
            }

            setLoading('loginBtn', 'loginText', 'loginSpinner', true);

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ account_key: normalizedKey })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    cacheSessionAccount(data.account_id, normalizedKey);
                    sessionStorage.setItem('vaultsphere.session.accountFingerprint', data.account_fingerprint || '');

                    showSuccess('Login successful! Redirecting...');
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1000);
                } else {
                    showError(data.error || 'Login failed');
                }
            } catch (error) {
                showError('Network error. Please try again.');
                console.error('Error:', error);
            } finally {
                setLoading('loginBtn', 'loginText', 'loginSpinner', false);
            }
        });

        document.getElementById('accountKeyInput').addEventListener('input', (event) => {
            const cursorPos = event.target.selectionStart;
            const normalized = normalizeAccountKey(event.target.value);
            const formatted = normalized.match(/.{1,4}/g)?.join('-') || '';
            event.target.value = formatted;
            event.target.setSelectionRange(cursorPos, cursorPos);
        });
    </script>
</body>
</html>
